
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>omicidx.biosample &#8212; OmicIDX  documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for omicidx.biosample</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Biosample parser</span>

<span class="sd">Implemented as an iterator</span>


<span class="sd">&gt;&gt;&gt; import omicidx.biosample as b</span>
<span class="sd">&gt;&gt;&gt; for bios in b.BioSampleParser(&#39;biosample_set.xml.gz&#39;):</span>
<span class="sd">&gt;&gt;&gt;     print(bios.as_json())</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="k">as</span> <span class="nn">ET</span>
<span class="kn">import</span> <span class="nn">gzip</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">click</span>
<span class="kn">import</span> <span class="nn">subprocess</span>


<div class="viewcode-block" id="BioSample"><a class="viewcode-back" href="../../omicidx.biosample.html#omicidx.biosample.BioSample">[docs]</a><span class="k">class</span> <span class="nc">BioSample</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;BioSample class&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

<div class="viewcode-block" id="BioSample.as_json"><a class="viewcode-back" href="../../omicidx.biosample.html#omicidx.biosample.BioSample.as_json">[docs]</a>    <span class="k">def</span> <span class="nf">as_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]))</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;BioSample &lt;id=</span><span class="si">{0}</span><span class="s1"> title=</span><span class="si">{1}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
                                                      <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]))</span></div>


<div class="viewcode-block" id="BioSampleParser"><a class="viewcode-back" href="../../omicidx.biosample.html#omicidx.biosample.BioSampleParser">[docs]</a><span class="k">class</span> <span class="nc">BioSampleParser</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parse a BioSample xml file.</span>

<span class="sd">    Implemented as an iterator&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Init</span>

<span class="sd">        Handles .gz as well as plain text&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fhandle</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">fname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;gz&#39;</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fhandle</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fhandle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">iterparse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fhandle</span><span class="p">,</span> <span class="n">events</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">))</span>
        <span class="n">event</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">event</span><span class="p">,</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="s2">&quot;end&quot;</span> <span class="ow">and</span> <span class="n">elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;BioSample&quot;</span><span class="p">:</span>
                <span class="n">bios</span> <span class="o">=</span> <span class="n">BioSample</span><span class="p">()</span>
                <span class="n">bios</span><span class="p">[</span><span class="s1">&#39;is_reference&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">elem</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">bios</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                <span class="n">bios</span><span class="p">[</span><span class="s1">&#39;id_recs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">bios</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">bios</span><span class="p">[</span><span class="s1">&#39;sra_sample&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">bios</span><span class="p">[</span><span class="s1">&#39;dbgap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">bios</span><span class="p">[</span><span class="s1">&#39;gsm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">elem</span><span class="o">.</span><span class="n">iterfind</span><span class="p">(</span><span class="s1">&#39;.//Id&#39;</span><span class="p">):</span>
                    <span class="n">idrec</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;db&#39;</span><span class="p">:</span> <span class="nb">id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;db&#39;</span><span class="p">),</span>
                        <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="nb">id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;db_label&#39;</span><span class="p">),</span>
                        <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="nb">id</span><span class="o">.</span><span class="n">text</span>
                    <span class="p">}</span>
                    <span class="n">bios</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idrec</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
                    <span class="n">bios</span><span class="p">[</span><span class="s1">&#39;id_recs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idrec</span><span class="p">)</span>
                    <span class="c1"># add xref fields for SRA, dbGaP, and GEO</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nb">id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;db&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;SRA&#39;</span><span class="p">):</span>
                        <span class="n">bios</span><span class="p">[</span><span class="s1">&#39;sra_sample&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">id</span><span class="o">.</span><span class="n">text</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;db&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;dbGaP&#39;</span><span class="p">):</span>
                        <span class="n">bios</span><span class="p">[</span><span class="s1">&#39;dbgap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">id</span><span class="o">.</span><span class="n">text</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;db&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;GEO&#39;</span><span class="p">):</span>
                        <span class="n">bios</span><span class="p">[</span><span class="s1">&#39;gsm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">id</span><span class="o">.</span><span class="n">text</span>
                <span class="n">bios</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">findtext</span><span class="p">(</span><span class="s1">&#39;.//Description/Title&#39;</span><span class="p">)</span>
                <span class="n">bios</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">findtext</span><span class="p">(</span>
                    <span class="s1">&#39;.//Description/Comment/Paragraph&#39;</span><span class="p">)</span>
                <span class="n">organism</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.//Organism&#39;</span><span class="p">)</span>
                <span class="n">bios</span><span class="p">[</span><span class="s1">&#39;taxonomy_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">organism</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;taxonomy_name&#39;</span><span class="p">)</span>
                <span class="n">bios</span><span class="p">[</span><span class="s1">&#39;taxon_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">organism</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;taxonomy_id&#39;</span><span class="p">))</span>
                <span class="n">bios</span><span class="p">[</span><span class="s1">&#39;attribute_recs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">bios</span><span class="p">[</span><span class="s1">&#39;attributes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">elem</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.//Attribute&#39;</span><span class="p">):</span>
                    <span class="n">attrec</span> <span class="o">=</span> <span class="n">attribute</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="n">attrec</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">attribute</span><span class="o">.</span><span class="n">text</span>
                    <span class="n">bios</span><span class="p">[</span><span class="s1">&#39;attribute_recs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attrec</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">bios</span><span class="p">[</span><span class="s1">&#39;attributes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attrec</span><span class="p">[</span><span class="s1">&#39;harmonized_name&#39;</span><span class="p">])</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">bios</span><span class="p">[</span><span class="s1">&#39;attributes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attrec</span><span class="p">[</span><span class="s1">&#39;attribute_name&#39;</span><span class="p">])</span>

                <span class="n">bios</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">findtext</span><span class="p">(</span><span class="s1">&#39;.//Model&#39;</span><span class="p">)</span>
                <span class="c1">#print(json.dumps(bios))</span>
                <span class="c1">#res = es.index(index=&quot;bioes&quot;, doc_type=&#39;biosample&#39;, id=bios[&#39;id&#39;], body=bios)</span>
                <span class="n">elem</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">bios</span></div>


<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>


<div class="viewcode-block" id="BioProject"><a class="viewcode-back" href="../../omicidx.biosample.html#omicidx.biosample.BioProject">[docs]</a><span class="k">class</span> <span class="nc">BioProject</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">pubs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span></div>


<div class="viewcode-block" id="BioProjectParser"><a class="viewcode-back" href="../../omicidx.biosample.html#omicidx.biosample.BioProjectParser">[docs]</a><span class="k">class</span> <span class="nc">BioProjectParser</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parse a BioProject xml file.</span>

<span class="sd">    Implemented as an iterator&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Init</span>

<span class="sd">        Handles .gz as well as plain text&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fhandle</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">fname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;gz&#39;</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fhandle</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fhandle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">iterparse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fhandle</span><span class="p">,</span> <span class="n">events</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">))</span>
        <span class="n">event</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">event</span><span class="p">,</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="s2">&quot;end&quot;</span> <span class="ow">and</span> <span class="n">elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;Package&quot;</span><span class="p">:</span>
                <span class="n">projtop</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;./Project&#39;</span><span class="p">)</span>
                <span class="n">d2</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">d2</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">projtop</span><span class="o">.</span><span class="n">findtext</span><span class="p">(</span><span class="s1">&#39;./Project/ProjectDescr/Title&#39;</span><span class="p">)</span>
                <span class="n">d2</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">projtop</span><span class="o">.</span><span class="n">findtext</span><span class="p">(</span>
                    <span class="s1">&#39;./Project/ProjectDescr/Description&#39;</span><span class="p">)</span>
                <span class="n">d2</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">projtop</span><span class="o">.</span><span class="n">findtext</span><span class="p">(</span><span class="s1">&#39;./Project/ProjectDescr/Name&#39;</span><span class="p">)</span>
                <span class="n">pubs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">pub</span> <span class="ow">in</span> <span class="n">projtop</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;.//Publication&quot;</span><span class="p">):</span>
                    <span class="n">pubs</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s2">&quot;pubdate&quot;</span><span class="p">:</span>
                        <span class="n">pub</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span>
                        <span class="s2">&quot;id&quot;</span><span class="p">:</span>
                        <span class="n">pub</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
                        <span class="s2">&quot;db&quot;</span><span class="p">:</span>
                        <span class="n">pub</span><span class="o">.</span><span class="n">findtext</span><span class="p">(</span><span class="s1">&#39;./DbType&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;^e&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="p">})</span>
                <span class="n">d2</span><span class="p">[</span><span class="s1">&#39;publications&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pubs</span>
                <span class="n">ext_links</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">projtop</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;.//ExternalLink&quot;</span><span class="p">):</span>
                    <span class="n">ext_links</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="n">link</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">],</span>
                        <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">link</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span>
                        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">link</span><span class="o">.</span><span class="n">findtext</span><span class="p">(</span><span class="s1">&#39;./URL&#39;</span><span class="p">)</span>
                    <span class="p">})</span>
                <span class="n">d2</span><span class="p">[</span><span class="s1">&#39;external_links&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ext_links</span>
                <span class="k">return</span> <span class="n">d2</span></div>

                <span class="c1"># bios = BioProject()</span>
                <span class="c1"># bios[&#39;is_reference&#39;]=None</span>
                <span class="c1"># for k,v in elem.items():</span>
                <span class="c1">#     bios[k] = v</span>
                <span class="c1"># bios[&#39;id_recs&#39;] = []</span>
                <span class="c1"># bios[&#39;ids&#39;] = []</span>
                <span class="c1"># bios[&#39;sra_sample&#39;]=None</span>
                <span class="c1"># bios[&#39;dbgap&#39;]=None</span>
                <span class="c1"># bios[&#39;gsm&#39;]=None</span>
                <span class="c1"># for id in elem.iterfind(&#39;.//Id&#39;):</span>
                <span class="c1">#     idrec = {&#39;db&#39;: id.get(&#39;db&#39;), &#39;label&#39;: id.get(&#39;db_label&#39;), &#39;id&#39;:id.text}</span>
                <span class="c1">#     bios[&#39;ids&#39;].append(idrec[&#39;id&#39;])</span>
                <span class="c1">#     bios[&#39;id_recs&#39;].append(idrec)</span>
                <span class="c1">#     # add xref fields for SRA, dbGaP, and GEO</span>

                <span class="c1">#     if(id.get(&#39;db&#39;)==&#39;SRA&#39;):</span>
                <span class="c1">#         bios[&#39;sra_sample&#39;]=id.text</span>
                <span class="c1">#     if(id.get(&#39;db&#39;)==&#39;dbGaP&#39;):</span>
                <span class="c1">#         bios[&#39;dbgap&#39;]=id.text</span>
                <span class="c1">#     if(id.get(&#39;db&#39;)==&#39;GEO&#39;):</span>
                <span class="c1">#         bios[&#39;gsm&#39;]=id.text</span>
                <span class="c1"># bios[&#39;title&#39;] = elem.findtext(&#39;.//Description/Title&#39;)</span>
                <span class="c1"># bios[&#39;description&#39;] = elem.findtext(&#39;.//Description/Comment/Paragraph&#39;)</span>
                <span class="c1"># organism = elem.find(&#39;.//Organism&#39;)</span>
                <span class="c1"># bios[&#39;taxonomy_name&#39;] = organism.get(&#39;taxonomy_name&#39;)</span>
                <span class="c1"># bios[&#39;taxon_id&#39;] = int(organism.get(&#39;taxonomy_id&#39;))</span>
                <span class="c1"># bios[&#39;attribute_recs&#39;] = []</span>
                <span class="c1"># bios[&#39;attributes&#39;] = []</span>
                <span class="c1"># for attribute in elem.findall(&#39;.//Attribute&#39;):</span>
                <span class="c1">#     attrec = attribute.attrib</span>
                <span class="c1">#     attrec[&#39;value&#39;] = attribute.text</span>
                <span class="c1">#     bios[&#39;attribute_recs&#39;].append(attrec)</span>
                <span class="c1">#     try:</span>
                <span class="c1">#         bios[&#39;attributes&#39;].append(attrec[&#39;harmonized_name&#39;])</span>
                <span class="c1">#     except:</span>
                <span class="c1">#         bios[&#39;attributes&#39;].append(attrec[&#39;attribute_name&#39;])</span>

                <span class="c1"># bios[&#39;model&#39;] = elem.findtext(&#39;.//Model&#39;)</span>
                <span class="c1"># #print(json.dumps(bios))</span>
                <span class="c1"># #res = es.index(index=&quot;bioes&quot;, doc_type=&#39;biosample&#39;, id=bios[&#39;id&#39;], body=bios)</span>
                <span class="c1"># elem.clear()</span>
                <span class="c1"># return bios</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">OmicIDX</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=seandavi&repo=omicidx&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Bigquery.html">OmicIDX dataset on Bigquery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cli.html">Commandline Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../genomic_metadata.html">Genomic metadata in OmicIDX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">omicidx</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Sean Davis.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.0.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    
    <a href="https://github.com/seandavi/omicidx" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>